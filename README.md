# Робот-голова Ампи: Управление + Эмоции

Улучшенная прошивка для робота-головы "Ампи", которая объединяет управление головой и отображение эмоций.

## Возможности

### Режим управления головой (по умолчанию)
- Управление головой с ИК-пульта:
  - `LEFT` / `RIGHT` - поворот влево/вправо
  - `UP` / `DOWN` - наклон вверх/вниз
  - Диагональные кнопки для комбинированных движений
- Глаза следуют за направлением поворота

### Режим эмоций
Переключение: нажмите `RED`

Эмоции (в режиме эмоций):
- `GREEN` - Радость (улыбка + моргание + звук)
- `MODE1` - Злость (сдвинутые брови + тряска головы + звук)
- `MODE2` - Грусть (опущенная голова + грустные глаза + звук)
- `MODE3` - Удивление (широкие глаза + подъём головы + звук)
- `BLUE` или стрелки - следующая эмоция по кругу

### Управление роботом
- `POWER` - включение/выключение робота
- `RED` - переключение между режимами

## Установка

### 1. Установите библиотеки в Arduino IDE

Установите следующие библиотеки через менеджер библиотек:
- **anyrtttl** - для воспроизведения мелодий
- **IRremote** - для работы с ИК-пульта
- **Servo** - для управления сервоприводами
- **TimerMs** - для работы с таймером
- **TroykaLedMatrix** - для управления LED-матрицами глаз

### 2. Настройте коды кнопок ИК-пульта

**ВАЖНО:** Коды в скетче указаны для примера. Вам нужно определить коды кнопок вашего пульта:

1. Загрузите в Arduino скетч из эксперимента №7 "Консольный ИК-приёмник"
2. Нажимайте кнопки пульта и записывайте коды
3. Замените коды в секции `enum CODE` файла `RobotHeadWithEmotions.ino`

Пример секции кодов:
```cpp
enum CODE {
  POWER = 0x0B,       // Замените на ваш код
  LEFT = 0x08,        // Замените на ваш код
  RIGHT = 0x19,       // Замените на ваш код
  // ... и так далее
};
```

### 3. Загрузите прошивку

1. Откройте файл `RobotHeadWithEmotions.ino` в Arduino IDE
2. Выберите плату: Arduino Nano
3. Выберите правильный COM-порт
4. Нажмите "Загрузить"

## Схема подключения

| Модуль | Пин |
|--------|-----|
| ИК-приёмник | D2 |
| Пьезопищалка | D3 |
| Сервопривод Yaw (влево-вправо) | A3 |
| Сервопривод Pitch (вверх-вниз) | A0 |
| LED-матрица левый глаз | I²C (0x60) |
| LED-матрица правый глаз | I²C (0x63) |

## Эмоции

### Радость (Happy)
- Изображение: улыбка
- Анимация: моргание
- Звук: возрастающая мелодия
- Движение: нет

### Злость (Angry)
- Изображение: сдвинутые вниз брови
- Анимация: тряска головы влево-вправо
- Звук: понижающийся агрессивный звук
- Движение: быстрая тряска головой

### Грусть (Sad)
- Изображение: опущенные уголки глаз
- Анимация: плавный переход
- Звук: снижающаяся мелодия
- Движение: плавное опускание головы

### Удивление (Surprised)
- Изображение: широкие глаза
- Анимация: резкое появление
- Звук: высокий короткий звук
- Движение: резкий подъём головы

## Режимы работы

### MODE_HEAD_CONTROL (режим управления головой)
- Стрелки пульта управляют сервоприводами
- Глаза следуют за направлением взгляда
- Кнопки эмоций работают как быстрые команды
- После 500мс бездействия глаза возвращаются в "Взгляд прямо"

### MODE_EMOTIONS (режим эмоций)
- Стрелки переключают между эмоциями
- Кнопки эмоций отображают соответствующую эмоцию
- Сервоприводы не управляются (кроме анимаций внутри эмоций)

## Настройка углов сервоприводов

Если голова поворачивается слишком много или мало, отредактируйте:

```cpp
// Углы поворота влево-вправо
constexpr uint8_t MAX_ANGLE_YAW_R = 0;   // Правый предел
constexpr uint8_t MAX_ANGLE_YAW_L = 180; // Левый предел

// Углы наклона вверх-вниз
constexpr uint8_t MAX_ANGLE_PITCH_DOWN = 60;  // Нижний предел
constexpr uint8_t MAX_ANGLE_PITCH_UP = 120;   // Верхний предел
```

## Создание собственных эмоций

1. Откройте редактор: https://amperka.github.io/led-matrix-editor/
2. Нарисуйте эмоцию
3. Скопируйте HEX-код
4. Добавьте в секцию `ИКОНКИ ЭМОЦИЙ`:
```cpp
constexpr uint8_t ICON_EYE_MY_EMOTION_L[] PROGMEM = {
  // ваш код для левого глаза
};
constexpr uint8_t ICON_EYE_MY_EMOTION_R[] PROGMEM = {
  // ваш код для правого глаза
};
```
5. Добавьте функцию анимации и обработчик кнопки

## Требуемые библиотеки

- anyrtttl: https://github.com/end2endzone/AnyRtttl
- IRremote: https://github.com/Arduino-IRremote/Arduino-IRremote
- Servo: встроена в Arduino IDE
- TimerMs: https://github.com/GyverLibs/TimerMs
- TroykaLedMatrix: https://github.com/amperka/TroykaLedMatrix

## Лицензия

CC BY-NC-SA 4.0 - исходный код от Амперки, модификации для добавления эмоций.
